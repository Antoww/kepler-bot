# Version 0.1.3 - Beta 1.3 (5 janvier 2026)

## üéØ R√©sum√© de la release

Cette release se concentre sur trois axes majeurs :
1. **Syst√®me de statistiques avanc√©** avec graphiques pour l'analyse d'utilisation
2. **Conformit√© RGPD** compl√®te pour toutes les donn√©es utilisateurs
3. **Optimisations techniques** (images, performance, latence)

---

## ‚ú® Nouvelles fonctionnalit√©s

### Statistiques avanc√©es (`/graph`)
- **Commande owner uniquement** : `/graph [type]` avec 5 types de graphiques
  - `commandes` : Top commandes utilis√©es (30 derniers jours)
  - `messages` : Volume de messages par jour (30 derniers jours)
  - `utilisateurs` : Utilisateurs actifs par jour (30 derniers jours)
  - `tendances` : Comparaison semaines (actuelle vs pr√©c√©dente)
  - `global` : Vue d'ensemble globale
- **Tracking automatique** :
  - Commandes ex√©cut√©es (par commande, utilisateur, serveur)
  - Messages envoy√©s (par utilisateur, canal, serveur)
  - Statistiques quotidiennes avec m√©triques globales
- **Tables Supabase** :
  - `command_stats` : Stats par commande
  - `message_stats` : Stats par message
  - `daily_stats` : Agr√©gation quotidienne
  - `global_daily_stats` : M√©triques globales
- **Module** : `utils/statsTracker.ts`

### RGPD & Protection des donn√©es (`/mesdonnees`)
- **Commande utilisateur** : `/mesdonnees [action]`
  - `voir` : R√©sum√© d√©taill√© de toutes les donn√©es
  - `exporter` : Export JSON complet (DMP via Pastebin)
  - `supprimer` : Effacement de toutes les donn√©es personnelles
  - `info` : Information sur la conservation des donn√©es
- **Donn√©es couvertes** :
  - Stats personnelles (commandes, messages)
  - Anniversaires
  - Rappels actifs
  - Avertissements
  - Historique de mod√©ration
  - Temp bans/mutes
  - Participations giveaways
- **Purge automatique** :
  - Stats : 90 jours de r√©tention
  - Mod√©ration : 2 ans de r√©tention
  - Ex√©cution quotidienne via `reminderManager`
- **Module** : `utils/rgpdManager.ts`

### Syst√®me de versioning
- **Fichiers de version** :
  - `version.json` : Version actuelle, codename, date, changelog
  - `bump-version.ts` : Script de bump automatique (major/minor/patch)
  - `CHANGELOG.md` : Historique complet des versions
  - `changelogs/` : Dossier avec d√©tails par version
- **Affichage** :
  - `/help` : Version + codename dans le footer
  - `/botstats` : Version dans les fields + codename dans le footer
- **Workflow Dokploy** : Documentation compl√®te dans `RELEASE.md`

---

## üîß Am√©liorations

### Optimisation images (`/couple`)
- **R√©duction drastique de la bande passante** :
  - Format : PNG ‚Üí **WebP** (compression ~60-70%)
  - Qualit√© : **85%** (compromis qualit√©/taille)
  - Taille avatars : 512px ‚Üí **128px** (16x moins de donn√©es)
  - R√©sultat : **~27KB ‚Üí ~10-15KB** par image
- **Cache intelligent** :
  - Map en m√©moire avec TTL de 5 minutes
  - √âvite les reg√©n√©rations pour les m√™mes paires
  - Nettoyage automatique des entr√©es expir√©es

### Correctifs de latence (`/ping`)
- **Mesure r√©elle** de la latence round-trip
  - Calcul pr√©cis : temps r√©ponse - temps requ√™te
  - Gestion des cas `-1ms` (websocket non pr√™t)
  - Affichage : `N/A` si latence invalide
- **Layout am√©lior√©** :
  - Suppression des spacer fields forc√©s
  - Grid naturel √† 3 colonnes (inline: true)
  - Meilleure lisibilit√© sur mobile

### Compatibilit√© Deno
- **Remplacement `process.cpuUsage()`** :
  - Node.js API ‚Üí `Deno.loadavg()`
  - Affichage du load average syst√®me
  - Plus de warnings dans la console

---

## üîí S√©curit√©

### Policies Supabase
- **RLS renforc√©** sur toutes les tables :
  - Policies `Allow all operations` pour service_role
  - Fixes pour les insertions bloqu√©es
  - `USING (true) WITH CHECK (true)`

### Fonctions s√©curis√©es
- **search_path** d√©fini pour toutes les fonctions
- Protection contre les injections SQL
- Validation des donn√©es d'entr√©e

---

## üìä Base de donn√©es

### Nouvelles tables
- `command_stats` : Tracking des commandes
- `message_stats` : Tracking des messages
- `daily_stats` : Agr√©gation quotidienne
- `global_daily_stats` : M√©triques globales

### Am√©lioration RLS
- Policies corrig√©es sur 15 tables
- Insertion/lecture/update/delete autoris√©s pour service_role
- Tests de charge valid√©s

---

## üìö Documentation

### READMEs cr√©√©s/mis √† jour
- **commands/README.md** : Table compl√®te des 40+ commandes
- **database/README.md** : Documentation des 15 tables Supabase
- **utils/README.md** : Modules utilitaires (stats, RGPD, retry)
- **events/README.md** : Gestionnaires d'√©v√©nements et managers
- **docs/README.md** : Index de la documentation technique

### Guides de release
- **RELEASE.md** : Workflow Dokploy complet (DEV/PROD)
- **changelogs/** : Dossier avec d√©tails par version
- Instructions de bump de version
- Checklist de release

---

## üêõ Corrections de bugs

### Discord.js
- ‚úÖ Fix latence affichant `-1ms`
- ‚úÖ Fix spacer fields dans les embeds
- ‚úÖ Fix warning `process.cpuUsage()` sous Deno

### Supabase
- ‚úÖ Fix RLS bloquant les inserts de stats
- ‚úÖ Fix policies trop restrictives

---

## ‚ö° Performance

### Images
- **WebP** : Compression sans perte de qualit√© visible
- **R√©duction avatars** : 512px ‚Üí 128px (suffisant pour le rendu)
- **Cache** : √âvite les reg√©n√©rations inutiles

### Base de donn√©es
- **Indexes** sur les colonnes fr√©quemment requ√™t√©es
- **Retry automatique** avec exponential backoff
- **Agr√©gations** optimis√©es pour les graphiques

---

## üèóÔ∏è Architecture

### Modules cr√©√©s
- `utils/statsTracker.ts` : Tracking et agr√©gation de stats
- `utils/rgpdManager.ts` : Gestion RGPD compl√®te
- `bump-version.ts` : Script de versioning automatique

### Modules mis √† jour
- `commands/general/help.ts` : Affichage de la version
- `commands/general/stats.ts` : Affichage de la version
- `commands/general/ping.ts` : Mesure r√©elle de latence
- `commands/games/couple.ts` : Optimisations WebP + cache
- `commands/utilitaires/mesdonnees.ts` : Int√©gration rgpdManager
- `events/core/reminderManager.ts` : Purge RGPD quotidienne

---

## üéØ Prochaines √©tapes (v0.2.0)

### Features envisag√©es
- Dashboard web pour visualiser les stats
- Export des graphiques en images
- Syst√®me de backup automatique
- API REST pour les stats
- Webhooks pour les √©v√©nements

### Optimisations futures
- Cache Redis pour les stats
- Compression des logs
- Archivage automatique des anciennes donn√©es

---

## üìù Notes de migration

### Pour les administrateurs
1. **Aucune action requise** : Les nouvelles tables sont cr√©√©es automatiquement
2. **RGPD** : Informer les utilisateurs de la commande `/mesdonnees`
3. **Stats** : Les graphiques n√©cessitent ~24h de donn√©es pour √™tre pertinents

### Pour les d√©veloppeurs
1. **Version.json** : Toujours bump avant une release
2. **Changelog** : Documenter dans `changelogs/vX.X.X.md`
3. **Tags Git** : Utiliser format `vX.X.X` pour Dokploy

---

## üîó Liens utiles

- [Documentation RGPD](../docs/)
- [Guide de release](../RELEASE.md)
- [Structure de la base de donn√©es](../database/README.md)
- [Liste des commandes](../commands/README.md)

---

**Codename** : Kepler Beta  
**Date de release** : 5 janvier 2026  
**Type** : Beta  
**Statut** : Stable ‚úÖ
